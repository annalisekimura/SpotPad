{% extends "layout.html" %}

{% block title %}Songs - My App{% endblock %}

{% block content %}

<!-- show each song -->

<div id="songs-container">
    {% for song in songs %}
    <div class="draggable" id="song_{{ loop.index }}">
        <img src="{{ song['album']['images'][0]['url'] }}" alt="Album Cover" width="100px" />
    </div>
    {% endfor %}
</div>

<script>
    // make each song draggable
    function makeDraggable(element) {
        var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;

        // keep position on reload
        var savedPosition = localStorage.getItem('song_' + element.id);
        if (savedPosition) {
            var positions = savedPosition.split(',');
            element.style.top = positions[0] + 'px';
            element.style.left = positions[1] + 'px';
        }

        element.onmousedown = dragMouseDown;

        function dragMouseDown(e) {
            e = e || window.event;
            e.preventDefault();
            pos3 = e.clientX;
            pos4 = e.clientY;
            document.onmouseup = closeDragElement;
            document.onmousemove = elementDrag;
        }

        function elementDrag(e) {
            e = e || window.event;
            e.preventDefault();
            pos1 = pos3 - e.clientX;
            pos2 = pos4 - e.clientY;
            pos3 = e.clientX;
            pos4 = e.clientY;
            element.style.top = (element.offsetTop - pos2) + "px";
            element.style.left = (element.offsetLeft - pos1) + "px";

            // save the position in local storage
            localStorage.setItem('song_' + element.id, `${element.offsetTop},${element.offsetLeft}`);
        }

        function closeDragElement() {
            document.onmouseup = null;
            document.onmousemove = null;
        }
    }

    // call the drag function
    var songs = document.querySelectorAll('.draggable');
    songs.forEach(function(song) {
        makeDraggable(song);
    });
    
</script>

{% endblock %}